{% extends '::base.html.twig' %}

{% block bread %}
    {{ parent() }}
    <li><a href="{{ url('app_category_view', {'category': product.getCategory.getSlug}) }}">{{ product.getCategory.getName }}</a></li>
    <li>{{ product.getName }}</li>
{% endblock %}

{% block body %}
    <div class="container container-sr">
        <div class="row">

            <div class="product-view-image">
                <div class="card is-linkable is-animated">
                    <a  class="feed-attachment-link"
                        title="{{ product.getName }}"
                        data-fancybox-initialized="0"
                        href="{{ asset_product(product.getImage) | imagine_filter('product_focus') }}"
                    >
                        <img src="{{ asset_product(product.getImage) | imagine_filter('product_view_thumbs') }}" alt="{{ product.getName }}" />
                    </a>
                </div>
            </div>

            <div class="product-view-info">
                <div class="card card-product-info">

                    <div class="product-name">
                        <h1>{{ product.getName }}</h1>
                    </div>

                    <hr />

                    {% if product.hasSku %}
                        <div class="product-sku">
                            <span class="label label-default">SKU: {{ product.getSku }}</span>
                        </div>
                    {% endif %}

                    {% if product.hasDescription %}
                        <div class="product-desc">
                            {{ product.getDescription }}
                        </div>
                    {% endif %}

                    <div class="product-price">
                        <p class="product-price-main">${{ product.getPrice|number_format(2, '.', ',') }}</p>
                        <p class="product-price-extra">
                            <em>${{ product.getShippingRate(config('rate.shipping', constant('AppBundle\\Entity\\Product::RATE_SHIPPING_DEFAULT')))|number_format(2, '.', ',') }}</em> shipping per unit
                            {% if product.isTaxable %}
                                / <em>{{ product.getTaxableRate(config('rate.taxable', constant('AppBundle\\Entity\\Product::RATE_TAX_PERCENTAGE')))|number_format(4, '.', ',') }}%</em> sales tax
                            {% endif %}
                        </p>
                    </div>

                    <div class="product-action">
                        <div class="product-add">
                            {% if cart_has(product) != true %}
                                {% include 'AppBundle:fragment:link-button.html.twig' with {
                                    'route' : 'app_cart_add',
                                    'args'  : {product: product.getId, quantity: 1},
                                    'icon'  : 'plus',
                                    'text'  : 'Add to cart'
                                } only %}
                            {% else %}
                                <div class="btn-group">
                                    {% include 'AppBundle:fragment:link-button.html.twig' with {
                                        'route' : 'app_cart_view',
                                        'icon'  : 'ios-cart',
                                        'text'  : cart_count(product) ~ ' in cart',
                                        'tip'   : 'View your cart'
                                    } only %}
                                    {% include 'AppBundle:fragment:link-button.html.twig' with {
                                        'route' : 'app_cart_remove_group',
                                        'args'  : {product: product.getId},
                                        'type'  : 'danger',
                                        'icon'  : 'trash-b',
                                        'tip'   : 'remove all'
                                    } only %}
                                    {% include 'AppBundle:fragment:link-button.html.twig' with {
                                        'route' : 'app_cart_remove',
                                        'args'  : {product: product.getId, quantity: 1},
                                        'type'  : 'warning',
                                        'icon'  : 'minus-circled',
                                        'tip'   : 'remove one'
                                    } only %}
                                    {% include 'AppBundle:fragment:link-button.html.twig' with {
                                        'route' : 'app_cart_add',
                                        'args'  : {product: product.getId, quantity: 1},
                                        'type'  : 'success',
                                        'icon'  : 'plus-circled',
                                        'tip'   : 'add another'
                                    } only %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="container-sr-odd">
        <div class="container">

            <h3 class="primary-hr-i">
                {{ ion('grid') }} Similar <em>Products</em>
            </h3>

            <div class="card-listing">
                {% for p in similar %}
                    {% include 'AppBundle:fragment:product-list-item-simple.html.twig' with { 'product': p } only %}
                {% endfor %}
            </div>

            {% include 'AppBundle:fragment:link-button-right.html.twig' with {
                'route' : 'app_category_view',
                'args'  : {'category': category.getSlug},
                'text'  : 'View More ' ~ category.getName
            } only %}

        </div>
    </div>
{% endblock %}
